{% extends 'frontend/base.html' %}

{% block style %}
    <style>
        .top-banner {
            background: linear-gradient(90deg, #fdfafa 0%, #f2f4f4 100%);
            color: black;
            padding: 0.8rem;
            text-align: center;
            position: relative;
            animation: slideDown 0.5s ease;
        }

        .close-banner {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: black;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .close-banner:hover {
            transform: translateY(-50%) rotate(90deg);
        }

        .calendar-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        .calendar-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }
        .nav-btn {
            background-color: #4dabf7;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .nav-btn:hover {
            background-color: #339af0;
        }
        .calendar-table {
            width: 100%;
            table-layout: fixed;
        }
        .calendar-table th {
            text-align: center;
            background-color: #f1f8ff;
            padding: 10px;
            font-weight: 600;
        }
        .calendar-table td {
            text-align: center;
            padding: 15px 5px;
            height: 50px;
            vertical-align: top;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .calendar-table td:hover {
            background-color: #f1f8ff;
        }
        .other-month {
            color: #adb5bd;
            background-color: #f8f9fa;
        }
        .today {
            background-color: #e3f2fd;
            font-weight: bold;
            border: 2px solid #2196f3;
            border-radius: 5px;
        }
        .day-number {
            font-size: 1.2rem;
            display: block;
            margin-bottom: 5px;
        }

        .events-container {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            text-align: center;
        }
        .year-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .year-selector select {
            width: 120px;
        }
        .selected-date {
            margin-top: 15px;
            padding: 10px;
            background-color: #f1f8ff;
            border-radius: 5px;
            text-align: center;
            font-weight: 500;
        }
    </style>
{% endblock %}

{% block content %}
    {% load static %}
    <div class="job-listing-area pt-100 pb-50 bg-color">
        <div class="top-banner">
            <span>Créer et actualiser profil et trouver les meilleures opportunités</span>
            <button class="close-banner" onclick="this.parentElement.style.display='none'">×</button>
        </div>
        <div class="container py-5">
            <div class="job-listing-top">
                <div class="row align-items-center">
                    <div class="col-lg-12">
                        <div class="job-listing-form">
                            <h2 class="text-white pb-10">GERTHE REPORT</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="browse-jobs-area-two pt-5 pb-50" style="background: #f1f1f1">
        <div class="container justify-content-center align-items-center">
            <div class="row">
                <div class="col-lg-4 col-md-4 mx-0">
                    <div class="pricing-card">
                        <div class="pricing-title">
                            <h2>Rapport Quotidien</h2>
                        </div>
                        <p class="mt-3">Bénéficiez de flexibilité avec nos rapports quotidiens adaptés.</p>
                        <div class="price-btn-area mt-5">
                            <a href="{% url 'reporting:list_reports' %}" class="price-btn">Rapport Quotidien</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 mx-0">
                    <div class="pricing-card">
                        <div class="pricing-title">
                            <h2>Rapport Hebdomadaire</h2>
                        </div>
                        <p class="mt-3">Contribuez à des projets clés avec une mission contractuelle.</p>
                        <div class="price-btn-area mt-5">
                            <a href="{% url 'reporting:list_reports' %}" class="price-btn">Rapport Hebdomadaire</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 mx-0">
                    <div class="pricing-card">
                        <div class="pricing-title">
                            <h2>Justificatif des Retards et Absences</h2>
                        </div>
                        <p class="mt-3">Rejoignez-nous pour une carrière durable et enrichissante.</p>
                        <div class="price-btn-area mt-5">
                            <a href="{% url 'reporting:list_reports' %}" class="price-btn">Justificatifs des retards et absences</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="blog-area pt-50">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-3 mx-auto">
                    <div class="section-title text-center">
                        <h2 style="font-size: 28px">CALENDRIER</h2>
                    </div>
                </div>
            </div>
            <div class="row pt-45 justify-content-center py-5">
                <div class="calendar-container">
                            <div class="year-selector">
                                <label for="year-select" class="form-label fw-bold">Année:</label>
                                <select class="form-select" id="year-select">
                                    <!-- Les options seront générées par JavaScript -->
                                </select>
                            </div>

                            <div class="calendar-header">
                                <button class="nav-btn" id="prev-month">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-chevron-left" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                              d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                                    </svg>
                                </button>
                                <h1 class="calendar-title" id="month-year"></h1>
                                <button class="nav-btn" id="next-month">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-chevron-right" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                              d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                </button>
                            </div>

                            <table class="table table-bordered calendar-table">
                                <thead>
                                <tr>
                                    <th>Lun</th>
                                    <th>Mar</th>
                                    <th>Mer</th>
                                    <th>Jeu</th>
                                    <th>Ven</th>
                                    <th>Sam</th>
                                    <th>Dim</th>
                                </tr>
                                </thead>
                                <tbody id="calendar-body">
                                <!-- Le calendrier sera généré ici par JavaScript -->
                                </tbody>
                            </table>

                            <div class="selected-date" id="selected-date">
                                Aucune date sélectionnée
                            </div>
                        </div>
            </div>
        </div>
    </div>
    <div class="browse-jobs-area-two pt-5" style="background: #1A8100;">
        <div class="container justify-content-center align-items-center">
            <div class="row">
                <div class="section-title">
                    <h2 style="color: #f1f1f1; font-weight: 300">Construisons l'avenir ensemble</h2>
                </div>
                <p class="mt-4" style="color: #f1f1f1; font-size: 15px">Notre mission au sein du Groupe Gerthe est de permettre au plus grand nombre de personnes,
                    possédant des compétences clés ou souhaitant les développer,
                    de trouver des opportunités qui leur permettront de s’épanouir. Dans un contexte où l’Afrique de
                    l’Ouest se distingue des autres continents par sa forte croissance démographique, il est
                    essentiel que chacun ait accès aux opportunités nécessaires pour réaliser son plein potentiel et
                    contribuer activement au développement de nos communautés.
                </p>
                <a href="{% url 'reporting:list_reports' %}" class="btn btn-outline-light mt-4 w-auto py-2 mb-5">Rapports</a>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables d'état
            let currentDate = new Date();
            const today = new Date();
            let selectedDate = null;

            // Éléments DOM
            const monthYearElement = document.getElementById('month-year');
            const calendarBody = document.getElementById('calendar-body');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const yearSelect = document.getElementById('year-select');
            const selectedDateElement = document.getElementById('selected-date');

            // Initialisation
            populateYearSelect();
            updateCalendar();

            // Écouteurs d'événements
            prevMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                updateCalendar();
            });

            nextMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                updateCalendar();
            });

            yearSelect.addEventListener('change', function() {
                currentDate.setFullYear(parseInt(this.value));
                updateCalendar();
            });

            function populateYearSelect() {
                const currentYear = today.getFullYear();
                // Ajouter les 10 années précédentes et les 10 années suivantes
                for (let year = currentYear - 10; year <= currentYear + 10; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    if (year === currentYear) {
                        option.selected = true;
                    }
                    yearSelect.appendChild(option);
                }
            }

            function updateCalendar() {
                const month = currentDate.getMonth();
                const year = currentDate.getFullYear();

                // Mettre à jour le sélecteur d'année
                yearSelect.value = year;

                // Afficher le mois et l'année
                const monthNames = [
                    "Janvier", "Février", "Mars", "Avril", "Mai", "Juin",
                    "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"
                ];
                monthYearElement.textContent = `${monthNames[month]} ${year}`;

                // Générer le calendrier
                generateCalendar(month, year);
            }

            function generateCalendar(month, year) {
                calendarBody.innerHTML = '';

                // Premier jour du mois
                const firstDay = new Date(year, month, 1);
                // Dernier jour du mois
                const lastDay = new Date(year, month + 1, 0);
                // Premier jour de la semaine (0 = dimanche, 1 = lundi, etc.)
                let firstDayOfWeek = firstDay.getDay();
                // Convertir pour que lundi soit le premier jour (0 = lundi)
                firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

                // Nombre de jours dans le mois
                const daysInMonth = lastDay.getDate();

                // Calculer le nombre de jours du mois précédent à afficher
                const prevMonthLastDay = new Date(year, month, 0).getDate();

                let date = 1;
                let prevMonthDate = prevMonthLastDay - firstDayOfWeek + 1;
                let nextMonthDate = 1;

                // Créer les 6 semaines du calendrier
                for (let i = 0; i < 6; i++) {
                    const row = document.createElement('tr');

                    for (let j = 0; j < 7; j++) {
                        const cell = document.createElement('td');
                        let cellDate;

                        // Première semaine - jours du mois précédent
                        if (i === 0 && j < firstDayOfWeek) {
                            cellDate = new Date(year, month - 1, prevMonthDate);
                            cell.innerHTML = `<span class="day-number">${prevMonthDate}</span>`;
                            cell.classList.add('other-month');
                            cell.dataset.date = cellDate.toISOString().split('T')[0];
                            prevMonthDate++;
                        }
                        // Jours du mois en cours
                        else if (date <= daysInMonth) {
                            cellDate = new Date(year, month, date);
                            // Vérifier si c'est aujourd'hui
                            const isToday = date === today.getDate() &&
                                           month === today.getMonth() &&
                                           year === today.getFullYear();

                            cell.innerHTML = `<span class="day-number">${date}</span>`;
                            cell.dataset.date = cellDate.toISOString().split('T')[0];

                            if (isToday) {
                                cell.classList.add('today');
                            }

                            // Vérifier si c'est la date sélectionnée
                            if (selectedDate &&
                                cellDate.getDate() === selectedDate.getDate() &&
                                cellDate.getMonth() === selectedDate.getMonth() &&
                                cellDate.getFullYear() === selectedDate.getFullYear()) {
                                cell.style.backgroundColor = '#d4edda';
                            }



                            // Ajouter un écouteur d'événement pour la sélection
                            cell.addEventListener('click', function() {
                                selectDate(cellDate);
                            });

                            date++;
                        }
                        // Jours du mois suivant
                        else {
                            cellDate = new Date(year, month + 1, nextMonthDate);
                            cell.innerHTML = `<span class="day-number">${nextMonthDate}</span>`;
                            cell.classList.add('other-month');
                            cell.dataset.date = cellDate.toISOString().split('T')[0];
                            nextMonthDate++;
                        }

                        row.appendChild(cell);
                    }

                    calendarBody.appendChild(row);

                    // Arrêter si nous avons affiché tous les jours du mois
                    // et que nous sommes dans la dernière semaine
                    if (date > daysInMonth && i >= 4) {
                        break;
                    }
                }
            }

            function selectDate(date) {
                selectedDate = date;
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                selectedDateElement.textContent = `Date sélectionnée: ${date.toLocaleDateString('fr-FR', options)}`;
                updateCalendar();
            }
        });
    </script>
{% endblock %}